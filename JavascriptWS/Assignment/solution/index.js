const foodItem = [
  {
    id: 1,
    name: "Ambur Biryani",
    category: "biryani",
    rating: 4.3,
    price: 13,
    img: "images/biryani/Ambur-Chicken-Biryani.jpg",
    quantity: 1,
  },
  {
    id: 2,
    name: "Hyderabadi Biryani",
    category: "biryani",
    rating: 4.3,
    price: 15,
    img: "images/biryani/Chicken-Biryani-hyd.jpg",
    quantity: 1,
  },
  {
    id: 3,
    name: "Egg Biryani",
    category: "biryani",
    rating: 4.3,
    price: 18,
    img: "images/biryani/egg-biryani.jpeg",
    quantity: 1,
  },
  {
    id: 4,
    name: "Goan Fish Biryani",
    category: "biryani",
    rating: 4.3,
    price: 15,
    img: "images/biryani/goan-fish-biryani.jpg",
    quantity: 1,
  },
  {
    id: 5,
    name: "Mutton Biryani",
    category: "biryani",
    rating: 4.3,
    price: 10,
    img: "images/biryani/hyd-Mutton-Biryani.jpg",
    quantity: 1,
  },
  {
    id: 6,
    name: "Kamrupi Biryani",
    category: "biryani",
    rating: 4.3,
    price: 12,
    img: "images/biryani/kamrupi-biryani.jpg",
    quantity: 1,
  },
  {
    id: 7,
    name: "Kashmiri Biryani",
    category: "biryani",
    rating: 4.3,
    price: 13,
    img: "images/biryani/kashmiri.pulao.jpg",
    quantity: 1,
  },
  {
    id: 8,
    name: "Memoni Biryani",
    category: "biryani",
    rating: 4.3,
    price: 20,
    img: "images/biryani/memonibiryani.png",
    quantity: 1,
  },
  {
    id: 9,
    name: "Mughlai Biryani",
    category: "biryani",
    rating: 4.3,
    price: 15,
    img: "images/biryani/mughlai-biryani.jpg",
    quantity: 1,
  },
  {
    id: 10,
    name: "Chicken Roast",
    category: "chicken",
    rating: 4.3,
    price: 11,
    img: "images/chicken/Chicken_roast.jpg",
    quantity: 1,
  },
  {
    id: 11,
    name: "Chicken Curry",
    category: "chicken",
    rating: 4.3,
    price: 10,
    img: "images/chicken/Chicken-Curry.jpg",
    quantity: 1,
  },
  {
    id: 12,
    name: "Chicken Do Pyaza",
    category: "chicken",
    rating: 4.3,
    price: 14,
    img: "images/chicken/Chicken-do-Pyaza.jpg",
    quantity: 1,
  },
  {
    id: 13,
    name: "Chicken Masala",
    category: "chicken",
    rating: 4.3,
    price: 12,
    img: "images/chicken/Chicken-Masala.jpeg",
    quantity: 1,
  },
  {
    id: 14,
    name: "Handi Chicken",
    category: "chicken",
    rating: 4.3,
    price: 17,
    img: "images/chicken/Handi-chicken.jpg",
    quantity: 1,
  },
  {
    id: 15,
    name: "Murgh Musallam",
    category: "chicken",
    rating: 4.3,
    price: 20,
    img: "images/chicken/Murgh-Musallam.jpg",
    quantity: 1,
  },
  {
    id: 16,
    name: "Matar Paneer",
    category: "paneer",
    rating: 4.3,
    price: 15,
    img: "images/paneer/Matar-Paneer.jpg",
    quantity: 1,
  },
  {
    id: 17,
    name: "Palak Paneer",
    category: "paneer",
    rating: 4.3,
    price: 10,
    img: "images/paneer/palak-paneer.jpg",
    quantity: 1,
  },
  {
    id: 18,
    name: "Paneer Butter Masala",
    category: "paneer",
    rating: 4.3,
    price: 15,
    img: "images/paneer/paneer-butter-masala.jpg",
    quantity: 1,
  },
  {
    id: 19,
    name: "Paneer Do Pyaza",
    category: "paneer",
    rating: 4.3,
    price: 12,
    img: "images/paneer/Paneer-Do-Pyaza.jpg",
    quantity: 1,
  },
  {
    id: 20,
    name: "Hyderabadi Paneer",
    category: "paneer",
    rating: 4.3,
    price: 8,
    img: "images/paneer/Paneer-Hyderabadi.jpg",
    quantity: 1,
  },
  {
    id: 21,
    name: "Paneer Lababdar",
    category: "paneer",
    rating: 4.3,
    price: 7,
    img: "images/paneer/paneer-lababdar.jpg",
    quantity: 1,
  },
  {
    id: 22,
    name: "Shahi Paneer",
    age: "32",
    category: "paneer",
    rating: 4.3,
    price: 5,
    img: "images/paneer/shahi-paneer.jpg",
    quantity: 1,
  },
  {
    id: 23,
    name: "Navratan Korma",
    category: "vegetable",
    rating: 4.3,
    price: 8,
    img: "images/vegetable/navratan-korma_-vegetable.png",
    quantity: 1,
  },
  {
    id: 24,
    name: "Veg Jalfrezi",
    category: "vegetable",
    rating: 4.3,
    price: 7,
    img: "images/vegetable/VEG-JALFREZI.jpg",
    quantity: 1,
  },
  {
    id: 25,
    name: "Veg Biryani",
    category: "vegetable",
    rating: 4.3,
    price: 5,
    img: "images/vegetable/vegetable-biryani.jpg",
    quantity: 1,
  },
  {
    id: 26,
    name: "Veg Curry",
    category: "vegetable",
    rating: 4.3,
    price: 7,
    img: "images/vegetable/vegetable-curry.jpeg",
    quantity: 1,
  },
  {
    id: 27,
    name: "Veg Kolhapur",
    category: "vegetable",
    rating: 4.3,
    price: 10,
    img: "images/vegetable/vegetable-kolhapuri.jpg",
    quantity: 1,
  },
  {
    id: 28,
    name: "Veg Masala",
    category: "vegetable",
    rating: 4.3,
    price: 4,
    img: "images/vegetable/vegetable-masala.jpg",
    quantity: 1,
  },
  {
    id: 29,
    name: "Veg Pakora",
    category: "vegetable",
    rating: 4.3,
    price: 4,
    img: "images/vegetable/vegetable-pakora.jpg",
    quantity: 1,
  },
  {
    id: 30,
    name: "Momos",
    category: "chinese",
    rating: 4.3,
    price: 8,
    img: "images/chinese/cabbage-momos-.jpg",
    quantity: 1,
  },
  {
    id: 31,
    name: "Chicken Manchurian",
    category: "chinese",
    rating: 4.3,
    price: 7,
    img: "images/chinese/ChickenManchurian.jpg",
    quantity: 1,
  },
  {
    id: 32,
    name: "Chili Chicken",
    category: "chinese",
    rating: 4.3,
    price: 5,
    img: "images/chinese/Chili-Chicken.jpg",
    quantity: 1,
  },
  {
    id: 33,
    name: "Chowmein",
    category: "chinese",
    rating: 4.3,
    price: 16,
    img: "images/chinese/chowmin.jpg",
    quantity: 1,
  },
  {
    id: 34,
    name: "Spring Roll",
    category: "chinese",
    rating: 4.3,
    price: 14,
    img: "images/chinese/spring-rolls.jpg",
    quantity: 1,
  },
  {
    id: 35,
    name: "Szechuan Chicken",
    category: "chinese",
    rating: 4.3,
    price: 10,
    img: "images/chinese/szechuan-chicken.jpg",
    quantity: 1,
  },
  {
    id: 36,
    name: "Fried Rice",
    category: "chinese",
    rating: 4.3,
    price: 8,
    img: "images/chinese/veg-fried-rice.jpg",
    quantity: 1,
  },
  {
    id: 37,
    name: "Butter Masala Dosa",
    category: "south indian",
    rating: 4.3,
    price: 18,
    img: "images/south indian/Butter-Masala-Dosa.png",
    quantity: 1,
  },
  {
    id: 38,
    name: "Idli",
    category: "south indian",
    rating: 4.3,
    price: 20,
    img: "images/south indian/idli-with-rice-flour.jpg",
    quantity: 1,
  },
  {
    id: 39,
    name: "Masala Dosa",
    category: "south indian",
    rating: 4.3,
    price: 12,
    img: "images/south indian/masala-dosa.jpg",
    quantity: 1,
  },
  {
    id: 40,
    name: "Mysore Bonda",
    category: "south indian",
    rating: 4.3,
    price: 10,
    img: "images/south indian/mysore-bonda.jpg",
    quantity: 1,
  },
  {
    id: 41,
    name: "Onion Uttapam",
    category: "south indian",
    rating: 4.3,
    price: 15,
    img: "images/south indian/onion-uttapam.jpg",
    quantity: 1,
  },
  {
    id: 42,
    name: "Plain Dosa",
    category: "south indian",
    rating: 4.3,
    price: 40,
    img: "images/south indian/plain-dosa.jpeg",
    quantity: 1,
  },
  {
    id: 43,
    name: "Rava Uttapam",
    category: "south indian",
    rating: 4.3,
    price: 25,
    img: "images/south indian/Rava-Uttapam.jpg",
    quantity: 1,
  },
  {
    id: 44,
    name: "Sambhar Vada",
    category: "south indian",
    rating: 4.3,
    price: 34,
    img: "images/south indian/sambhar-vada.jpg",
    quantity: 1,
  },
];

var cartele = document.getElementById('cart-page')
cartele.style.display = 'none'
var foodele = document.getElementById('food')
foodele.style.display='block'
/**
 * Used to create the rows for every item in the list of items passed
 * for any category of users choice
 */
function displayItem(items)
{
    var html="";
    items.map((item) => {
        html += `<div class='row text-center item'>
            <div class="col-md-3">
            <img class='img-fluid' src='./${item.img}'/>
        </div>
        <div class="col-md-2">
            <p>${item.name}</p>
        </div>
        <div class="col-md-2">
            <p>${item.price}</p>
        </div>
        <div class="col-md-2">
            <p>${item.rating}</p>
        </div>
        <div class="col-md-2">
            <p><input type='checkbox' id='ch${item.id}' onClick='addToCart(${item.id})'/></p>
        </div>
        </div>`;
      });
      return html;
}
/**
 * this function is called when a particular item is selected from 
 * dropdown. based on the category it fetches all the items and invokes
 * displayItem function passing the list of items for that category
 */
function onCategoryChange() {
  var categoryele = document.getElementById("category");
  var category = categoryele.value;
  var itemsele = document.getElementById("items");
  console.log("category ", category);
  switch (category) {
    case "biryani":
      var biryaniItems = foodItem.filter((item) => item.category === "biryani");
      itemsele.innerHTML=''
      itemsele.innerHTML += displayItem(biryaniItems);
      break;
    case "chicken":
      var chickenItems = foodItem.filter((item) => item.category === "chicken");
      itemsele.innerHTML=''
      itemsele.innerHTML += displayItem(chickenItems);
      break;
    case "paneer":
      var paneerItems = foodItem.filter((item) => item.category === "paneer");
      itemsele.innerHTML=''
      itemsele.innerHTML += displayItem(paneerItems);
      break;
    case "vegetable":
      var vegItems = foodItem.filter((item) => item.category === "vegetable");
      itemsele.innerHTML=''
      itemsele.innerHTML += displayItem(vegItems);
      break;
    case "south indian":
      var southindianItems = foodItem.filter(
        (item) => item.category === "south indian"
      );
      itemsele.innerHTML=''
      itemsele.innerHTML += displayItem(southindianItems);
      break;
    case "chinese":
      var chineseItems = foodItem.filter((item) => item.category === "chinese");
      itemsele.innerHTML=''
      itemsele.innerHTML += displayItem(chineseItems);
      break;
  }
}
onCategoryChange();

var cartData = [];
// adding item in the cartData
function addToCart(itemid) {
    console.log(this)
  console.log(itemid);
  var id = parseInt(itemid);
  console.log(id);
  var itemToAdd = foodItem.find((item) => item.id === id);
  console.log(itemToAdd);
  if (cartData.indexOf(itemToAdd) == -1) {
    // mutability and immutability of the objects, spread operator
    cartData = [...cartData, itemToAdd];
    console.log(cartData);
    //document.getElementById(id).classList.add("toggle-heart");
  } else {
    alert("Item already added in the cart");
    var ele = document.getElementById(`ch${itemid}`)
    console.log(ele)
    ele.checked = true;
  }

  document.getElementById("cart-plus").innerText =
    "" + cartData.length + " Items";
  //cartItems();
}

// to toggle the div from list of items to the cart items
//document.getElementById("cart-plus").addEventListener("click", cartToggle);
// once i clicked on Items it displays the items in the cart
var temphtml = ''
function cartItems() {
    foodele.style.display='none'
   cartele.style.display ='block';
  //alert('displaying cart items');
  var tbody = document.getElementById("table-body");

  tbody.innerHTML = "";
  // alert(cartData.length)
  cartData.map((item) => {
    var itemrow = document.createElement("tr");

    var col1 = document.createElement("td");
    var img = document.createElement("img");
    img.src = item.img;

    col1.appendChild(img);

    var col2 = document.createElement("td");
    col2.innerText = item.name;

    var col3 = document.createElement("td");
    var b1 = document.createElement("button");
    b1.setAttribute("class", "decrease-item");
    b1.setAttribute("id", item.id);
    b1.innerText = "-";

    var span = document.createElement("span");
    span.innerText = item.quantity;

    var b2 = document.createElement("button");
    b2.setAttribute("class", "increase-item");
    b2.setAttribute("id", item.id);
    b2.innerText = "+";
    col3.appendChild(b1);
    col3.appendChild(span);
    col3.appendChild(b2);

    var col4 = document.createElement("td");
    col4.innerText = item.price;

    itemrow.appendChild(col1);
    itemrow.appendChild(col2);
    itemrow.appendChild(col3);
    itemrow.appendChild(col4);
    tbody.appendChild(itemrow);
  });

  document.querySelectorAll(".increase-item").forEach((item) => {
    item.addEventListener("click", incrementItem);
  });

  document.querySelectorAll(".decrease-item").forEach((item) => {
    item.addEventListener("click", decrementItem);
  });

  totalAmount();
}

function incrementItem() {
  console.log("increase");
  // let itemToInc = this.parentNode.previousSibling.innerText
  // console.log(itemToInc);
  let id = this.getAttribute("id");
  console.log(id);
  let itemInCart = cartData.find(
    (itemincart) => itemincart.id === parseInt(id)
  );
  console.log(itemInCart);
  itemInCart.quantity += 1;
  // 4 = 45
  // (45 * 4 - 45 * 3) / 3 = 180 - 135 = 45/3 = 15
  curPrice =
    (itemInCart.price * itemInCart.quantity -
      itemInCart.price * (itemInCart.quantity - 1)) /
    (itemInCart.quantity - 1);
  console.log(curPrice);
  itemInCart.price = curPrice * itemInCart.quantity;
  cartItems();
  totalAmount();
}

function decrementItem() {
  console.log("decrease");
  let id = this.getAttribute("id");
  console.log(id);
  let itemToDecr = cartData.find(
    (itemincart) => itemincart.id === parseInt(id)
  );
  let idx = cartData.indexOf(itemToDecr);
  if (itemToDecr.quantity > 1) {
    curPrice =
      (itemToDecr.quantity * itemToDecr.price -
        itemToDecr.price * (itemToDecr.quantity - 1)) /
      itemToDecr.quantity;
    console.log("decrement ", curPrice);
    itemToDecr.quantity -= 1;
    itemToDecr.price = itemToDecr.quantity * curPrice;
  } else {
    cartData.splice(idx, 1);
    document.getElementById("cart-plus").innerText =
      "" + cartData.length + " items";
    if (cartData.length < 1) {
      foodele.style.display='block'
      cartele.style.display ='none';
      alert("Currently no items in the cart");
      return;
    }
  }
  totalAmount();
  cartItems();
}

function totalAmount() {
  var sum = 0;
  cartData.map((item) => {
    sum += item.price;
  });
  document.getElementById("total-price").innerText = "Total Price : " + sum;
}

